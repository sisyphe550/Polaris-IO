syntax = "proto3";

option go_package = "./pb";

package pb;

// =====================================
// Data Models (数据模型)
// =====================================

message User {
  int64  id = 1;
  string mobile = 2;
  string nickname = 3;
  string avatar = 4;
  string info = 5;
}

// =====================================
// Request & Response (请求与响应)
// =====================================

// 1. 注册请求
message RegisterReq {
  string mobile = 1;
  string password = 2;
  string nickname = 3; // 可选，默认为手机号或随机生成
  string authKey = 4;  // 认证标识 (手机号/OpenId)
  string authType = 5; // 认证类型 (mobile/wx)
}

message RegisterResp {
  string accessToken = 1;
  int64  accessExpire = 2;
  int64  refreshAfter = 3;
}

// 2. 登录请求
message LoginReq {
  string authType = 1; // mobile/wx
  string authKey = 2;  // 手机号/OpenId
  string password = 3; // 仅 mobile 类型需要
}

message LoginResp {
  string accessToken = 1;
  int64  accessExpire = 2;
  int64  refreshAfter = 3;
}

// 3. 获取用户信息
message GetUserInfoReq {
  int64 userId = 1;
}

message GetUserInfoResp {
  User user = 1;
}

// 4. 生成 Token (内部通用方法)
message GenerateTokenReq {
  int64 userId = 1;
}

message GenerateTokenResp {
  string accessToken = 1;
  int64  accessExpire = 2;
  int64  refreshAfter = 3;
}

// =====================================
// Service Definition (服务定义)
// =====================================

service usercenter {
  // -----------------------
  // 业务逻辑接口
  // -----------------------
  
  // 登录
  rpc login(LoginReq) returns(LoginResp);
  
  // 注册
  rpc register(RegisterReq) returns(RegisterResp);
  
  // 获取用户信息
  rpc getUserInfo(GetUserInfoReq) returns(GetUserInfoResp);
  
  // -----------------------
  // 工具/基础能力接口
  // -----------------------
  
  // 生成 Token (供内部逻辑调用)
  rpc generateToken(GenerateTokenReq) returns(GenerateTokenResp);
}